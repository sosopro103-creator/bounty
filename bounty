repeat task.wait() until game:IsLoaded()

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- SETTINGS (simplified & SkibX safe)
local Setting = {
    Team = "Pirates",
    AttackDistance = 25,
    Delay = 1.2,
    Enabled = true
}

-- Auto team
pcall(function()
    if LocalPlayer.Team and LocalPlayer.Team.Name ~= Setting.Team then
        for _,v in pairs(getgc(true)) do
            if type(v) == "table" and rawget(v,"ChangeTeam") then
                v.ChangeTeam(Setting.Team)
            end
        end
    end
end)

-- Character
local function getChar()
    return LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
end

-- Get closest player
local function getTarget()
    local char = getChar()
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local closest, dist = nil, math.huge

    for _,plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character then
            local ehrp = plr.Character:FindFirstChild("HumanoidRootPart")
            local hum = plr.Character:FindFirstChild("Humanoid")
            if ehrp and hum and hum.Health > 0 then
                local d = (ehrp.Position - hrp.Position).Magnitude
                if d < Setting.AttackDistance and d < dist then
                    dist = d
                    closest = plr
                end
            end
        end
    end

    return closest
end

-- Attack (simple)
task.spawn(function()
    while task.wait(Setting.Delay) do
        if not Setting.Enabled then continue end

        local target = getTarget()
        if target and target.Character then
            pcall(function()
                mouse1click()
            end)
        end
    end
end)

-- Toggle with P
game:GetService("UserInputService").InputBegan:Connect(function(i,g)
    if g then return end
    if i.KeyCode == Enum.KeyCode.P then
        Setting.Enabled = not Setting.Enabled
        warn("Auto Attack:", Setting.Enabled)
    end
end)
